---
// Componente para mostrar la lista de noticias agrupadas por fecha
import NewsCard from "./NewsCard.astro";
import type { CollectionEntry } from "astro:content";
import TopPanel from "./TopPanel.astro";

interface Props {
    groupedPosts: Record<string, CollectionEntry<"blog">[]>;
}

const { groupedPosts } = Astro.props;

// Obtener la fecha actual y formatearla en español
const now = new Date();
const day = now.getDate();
const month = now.getMonth();
const year = now.getFullYear();
const weekday = new Date().toLocaleString("es-ES", { weekday: "long" });

const months = [
    "enero",
    "febrero",
    "marzo",
    "abril",
    "mayo",
    "junio",
    "julio",
    "agosto",
    "septiembre",
    "octubre",
    "noviembre",
    "diciembre",
];

const formattedDate = `${day} de ${months[month]} de ${year}`;
const capitalizedWeekday =
    weekday.charAt(0).toUpperCase() + weekday.slice(1);
const todayFullDate = `${capitalizedWeekday}, ${formattedDate}`;
---

<div class="news-container">
    <TopPanel date={formattedDate} />

    <div class="news-content">
        <div class="news-column">
            {
                Object.entries(groupedPosts).map(
                    ([date, datePosts], dateIndex) => (
                        <div
                            class={`news-date-group ${dateIndex === 0 ? "today-group" : ""}`}
                        >
                            <div class="date-header">
                                {dateIndex === 0 ? (
                                    <>
                                        <div class="date-header-main">
                                            <span class="date-badge">Novedades de hoy</span>
                                            <h3 class="date-heading">{todayFullDate}</h3>
                                        </div>
                                        <p class="date-subheading">
                                            Seguimos monitoreando los mercados y compañías en tiempo real.
                                        </p>
                                    </>
                                ) : (
                                    <div class="date-header-main">
                                        <h3 class="date-heading">Noticias del {date}</h3>
                                        <span class="date-tag">Cobertura anterior</span>
                                    </div>
                                )}
                            </div>
                            <div class="news-grid">
                                {datePosts.map((post, index) => (
                                    <NewsCard
                                        title={post.data.title}
                                        url={`/blog/${post.id}/`}
                                        isHighlight={
                                            index === 0 && dateIndex === 0
                                        }
                                        category={"Noticias"}
                                        pubDate={post.data.pubDate}
                                    />
                                ))}
                            </div>
                        </div>
                    ),
                )
            }
        </div>
    </div>
</div>

<style>
    :global(:root) {
        --news-accent: var(--primary-blue);
        --news-accent-soft: rgba(25, 118, 210, 0.08);
        --news-muted: var(--gray-500);
        --news-muted-strong: var(--gray-700);
    }

    .news-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 2rem;
    }

    .news-content {
        display: flex;
        justify-content: center;
        margin-top: 2rem;
    }

    .news-column {
        max-width: 1000px;
        width: 100%;
    }

    .date-header {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        padding: 1.5rem 1.75rem;
        margin-bottom: 1.75rem;
        border-radius: 18px;
        background: linear-gradient(135deg, var(--news-accent-soft), rgba(255, 255, 255, 0.85));
        border: 1px solid rgba(124, 58, 237, 0.16);
        box-shadow: 0 12px 32px rgba(15, 23, 42, 0.08);
    }

    .date-header-main {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
    }

    .date-badge {
        display: inline-flex;
        align-self: flex-start;
        align-items: center;
        gap: 0.4rem;
        padding: 0.35rem 0.75rem;
        border-radius: 999px;
        background-color: rgba(124, 58, 237, 0.16);
        color: var(--news-accent);
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.04em;
        text-transform: uppercase;
    }

    .date-tag {
        display: inline-flex;
        align-self: flex-start;
        padding: 0.35rem 0.75rem;
        border-radius: 999px;
        background-color: rgba(148, 163, 184, 0.18);
        color: var(--news-muted);
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.04em;
        text-transform: uppercase;
    }

    .date-heading {
        margin: 0;
        font-size: 1.45rem;
        font-weight: 700;
        color: var(--news-muted-strong);
    }

    .date-subheading {
        margin: 0;
        font-size: 0.95rem;
        color: var(--news-muted);
        line-height: 1.5;
    }

    .news-date-group {
        margin-bottom: 2.5rem;
        position: relative;
    }

    .news-date-group:last-child {
        margin-bottom: 0;
    }

    .news-grid {
        display: block;
    }

    @media (max-width: 1024px) {
        .news-container {
            max-width: 100%;
        }
    }

    @media (max-width: 768px) {
        .news-container {
            padding: 0 1.25rem;
        }

        .date-header {
            padding: 1.25rem 1.5rem;
        }

        .date-heading {
            font-size: 1.3rem;
        }

        .date-subheading {
            font-size: 0.9rem;
        }

        .news-date-group {
            margin-bottom: 2rem;
        }
    }

    @media (max-width: 480px) {
        .news-container {
            padding: 0 1rem;
        }

        .date-header {
            padding: 1rem 1.25rem;
            gap: 0.55rem;
        }

        .date-heading {
            font-size: 1.1rem;
        }

        .date-badge,
        .date-tag {
            font-size: 0.7rem;
        }

        .date-subheading {
            font-size: 0.85rem;
        }
    }

</style>
